erDiagram
    Users ||--o{ Orders : places
    Users ||--o{ Cart : has

    Products ||--o{ OrderItems : contains
    Products ||--o{ CartItems : contains
    Products ||--o{ ProductAttributes : has
    Products ||--o{ ProductCategories : belongs_to
    Products ||--o{ ProductCollections : belongs_to
    Products ||--o{ InventoryHistory : tracks
    Files ||--o{ ProductImages : used_in
    Products ||--o{ ProductImages : has

    Categories ||--o{ ProductCategories : has

    Collections ||--o{ ProductCollections : contains

    Attributes ||--o{ ProductAttributes : defines

    Cart ||--o{ CartItems : contains

    Orders ||--o{ OrderItems : contains
    Orders ||--o{ OrderStatusHistory : tracks

    Users {
        id UUID PK
        email string
        password_hash string
        role enum
        first_name string
        last_name string
        phone string
        created_at timestamp
        updated_at timestamp
        last_login timestamp
        oauth_provider string
        oauth_id string
    }

    Products {
        id UUID PK
        name string
        description text
        base_price decimal
        current_price decimal
        sku string
        current_stock int
        thumbnail_id UUID FK "References Files"
        created_at timestamp
        updated_at timestamp
        status enum
    }

    Categories {
        id UUID PK
        name string
        description text
        parent_id UUID FK
        created_at timestamp
        updated_at timestamp
    }

    Collections {
        id UUID PK
        name string
        description text
        start_date timestamp
        end_date timestamp
        created_at timestamp
        updated_at timestamp
    }
    
    Attributes {
        id UUID PK
        name string
        type enum
        created_at timestamp
        updated_at timestamp
    }

    ProductAttributes {
        id UUID PK
        product_id UUID FK
        attribute_id UUID FK
        value string
        created_at timestamp
        updated_at timestamp
    }

    ProductCategories {
        product_id UUID FK
        category_id UUID FK
        created_at timestamp
    }

    ProductCollections {
        product_id UUID FK
        collection_id UUID FK
        created_at timestamp
    }

    Cart {
        id UUID PK
        user_id UUID FK
        created_at timestamp
        updated_at timestamp
    }

    CartItems {
        id UUID PK
        cart_id UUID FK
        product_id UUID FK
        quantity int
        price_at_time decimal
        created_at timestamp
        updated_at timestamp
    }
    
    Orders {
        id UUID PK
        user_id UUID FK
        total_amount decimal
        payment_status enum
        payment_method enum
        delivery_address text
        contact_phone string
        created_at timestamp
        updated_at timestamp
    }

    OrderItems {
        id UUID PK
        order_id UUID FK
        product_id UUID FK
        quantity int
        price_at_time decimal
        created_at timestamp
    }

    OrderStatusHistory {
        id UUID PK
        order_id UUID FK
        status enum
        updated_by UUID FK
        notes text
        created_at timestamp
    }

    InventoryHistory {
        id UUID PK
        product_id UUID FK
        quantity_changed int
        type enum
        reference_id UUID
        notes text
        created_at timestamp
    }

    Files {
        id UUID PK
        original_name string
        file_key string
        file_type string
        size number
        bucket string
        created_at timestamp
    }

    ProductImages {
        id UUID PK
        product_id UUID FK
        file_id UUID FK
        display_order int "For controlling image sequence"
        is_primary boolean "Flag for main product image"
        created_at timestamp
        updated_at timestamp
    }